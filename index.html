<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>CSS Table</title>
  </head>
  <body>
    <h1>Interactive table</h1>
    <div class="add-invoice-container">
      <button id="open">Add invoice +</button>
      <!-- <button onclick="addInvoice()" id="add">Add test</button> -->
    </div>

    <div class="modal-container" id="modal-container">
      <div class="modal">
        <div class="modal-header">
          <h1>Submit new invoice</h1>
          <button id="close">X</button>

        </div>
        <p>
          <form onsubmit="submitInvoice(event)" id="invoiceForm">
            <input required id="newInvoiceId" type="number" placeholder="Invoice number">
            <input required id="newInvoiceCompany" type="text" placeholder="Company">
            <input required id="newInvoiceDate" type="date" placeholder="Due date">
            <select required name="statuses" id="newInvoiceStatus">
              <option value="unpaid">Unpaid</option>
              <option value="pending">Pending</option>
              <option value="paid">Paid</option>
            </select>
            <input required id="newInvoiceAmount" type="number" placeholder="Amount (NOK)" >
            <button type="submit">Submit</button>
          </form>
        </p>
      </div>
    </div>

    <table id="table2">
      <thead>
        <tr>
          <th onclick="sortColumn('invoiceID')">Invoice</th>
          <th onclick="sortColumn('company')">Company</th>
          <th onclick="sortColumn('dueDate')">Due date</th>
          <th onclick="sortColumn('status')">Status</th>
          <th onclick="sortColumn('amount')">Amount</th>
          <th >Actions</th>
        </tr>
      </thead>
      <tbody id="table2data"></tbody>
    </table>
    <p id="reference">
      Based on tutorial by
      <a href="https://www.youtube.com/watch?v=Oy9K7iz3aa4">Angela Delise</a>
    </p>
  </body>
  <script>
    let sortDirection = false;
    let tableData = [
      {
        invoiceID: 1001,
        company: "DNB",
        dueDate: new Date(2022, 4, 21),
        status: "unpaid",
        amount: 520009,
      },
      {
        invoiceID: 1002,
        company: "SBanken",
        dueDate: new Date(2022, 7, 18),
        status: "paid",
        amount: 111200,
      },
      {
        invoiceID: 1003,
        company: "Bank Norwegian",
        dueDate: new Date(2022, 5, 14),
        status: "pending",
        amount: 448900,
      },
      {
        invoiceID: 1004,
        company: "DanskeBanken",
        dueDate: new Date(2022, 7, 22),
        status: "pending",
        amount: 115200,
      },
      {
        invoiceID: 1005,
        company: "Sparebank 1",
        dueDate: new Date(2021, 11, 19),
        status: "paid",
        amount: 334500,
      },
    ];
    const open = document.getElementById("open");
    const modalContainer = document.getElementById("modal-container");
    const close = document.getElementById("close");


    open.addEventListener("click", () => {
      modalContainer.classList.add("show");
    });
    close.addEventListener("click", () => {
      modalContainer.classList.remove("show");
    });

    loadTableData(tableData);

    function loadTableData(tableData) {
      const tableBody = document.getElementById("table2data");
      let dataHtml = "";

      for (let data of tableData) {
        dataHtml += `
          <tr>
            <td><a href="#">INV__${data.invoiceID}</a></td>
            <td>${data.company}</td>
            <td>${formatDate(data.dueDate)}</td>
            <td><p class="status status-${data.status}">${data.status}</p></td>
            <td class="amount">${formatCurrency(data.amount)}</td>
            <td><Button>Edit</Button></td>
          </tr>
        `;
      }

      tableBody.innerHTML = dataHtml;
    }

    function formatDate(date) {
      return date.toLocaleString("no-No").slice(0, -10);
    }

    function formatCurrency(amount) {
      return amount.toLocaleString("no-NO", {
        style: "currency",
        currency: "NOK",
        maximumFractionDigits: 0,
      });
    }

    function sortColumn(columnName) {
      const dataType = typeof tableData[0][columnName];
      sortDirection = !sortDirection;

      switch (dataType) {
        case "number":
          sortNumberColumn(sortDirection, columnName);
          break;
        case "string":
          sortNumberString(sortDirection, columnName);
          break;
        case "object":
          sortNumberDate(sortDirection, columnName);
          break;
      }

      loadTableData(tableData);
    }

    function sortNumberColumn(sort, columnName) {
      tableData = tableData.sort((a, b) => {
        return sort
          ? a[columnName] - b[columnName]
          : b[columnName] - a[columnName];
      });
    }

    function sortNumberString(sort, columnName) {
      console.log("sort by string");
      console.log(columnName);
      console.log(sort);

      if (sort) {
        tableData.sort((a, b) =>
          a.status > b.status ? 1 : b.status > a.status ? -1 : 0
        );
      } else {
        tableData.sort((a, b) =>
          a.status < b.status ? 1 : b.status < a.status ? -1 : 0
        );
      }
    }

    function sortNumberDate(sort, columnName) {
      tableData = tableData.sort((a, b) => {
        return sort
          ? Number(a.dueDate) - Number(b.dueDate)
          : Number(b.dueDate) - Number(a.dueDate);
      });
    }

    function addInvoice() {
      console.log("add test invoice");
      const newInvoice = {
        invoiceID: 1006,
        company: "DNB",
        dueDate: new Date(2022, 7, 29),
        status: "unpaid",
        amount: 520009,
      };
      tableData.push(newInvoice)
      loadTableData(tableData);
    }

    function submitInvoice(e) {
      e.preventDefault();
      // Form input values
      const newInvoiceID = document.getElementById('newInvoiceId').value
      const newInvoiceCompany = document.getElementById('newInvoiceCompany').value
      const newInvoiceDate = document.getElementById('newInvoiceDate').value
      const newInvoiceStatus = document.getElementById('newInvoiceStatus').value
      const newInvoiceAmount = document.getElementById('newInvoiceAmount').value

      const newInvoice = {
        invoiceID: newInvoiceID,
        company: newInvoiceCompany,
        dueDate: new Date(newInvoiceDate),
        status: newInvoiceStatus,
        amount: newInvoiceAmount,
      };
      tableData.push(newInvoice)
      loadTableData(tableData);
      modalContainer.classList.remove("show");
      document.getElementById('invoiceForm').reset()
      
    }
  </script>
</html>
